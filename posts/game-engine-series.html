<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alex's Blog | Equilibrium Engine</title>
  <meta name="description" content="Welcome to my Game Engine series. Here I will share my journey of creating a multi-threaded engine using ECS from scratch using C/C++ and applying Data Oriented Design.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Equilibrium Engine">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://clibequilibrium.github.io//posts/game-engine-series">
  <meta property="og:description" content="Welcome to my Game Engine series. Here I will share my journey of creating a multi-threaded engine using ECS from scratch using C/C++ and applying Data Oriented Design.">
  <meta property="og:site_name" content="Alex's Blog">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://clibequilibrium.github.io//posts/game-engine-series">
  <meta name="twitter:title" content="Equilibrium Engine">
  <meta name="twitter:description" content="Welcome to my Game Engine series. Here I will share my journey of creating a multi-threaded engine using ECS from scratch using C/C++ and applying Data Oriented Design.">

  
    
      <meta property="og:image" content="https://clibequilibrium.github.io//assets/posts/game_engine-22dbc7278ecbb67698cba538d3e5ee21846cd51c7ed2a389e44046c29be900f6.png">
      <meta name="twitter:image" content="https://clibequilibrium.github.io//assets/posts/game_engine-22dbc7278ecbb67698cba538d3e5ee21846cd51c7ed2a389e44046c29be900f6.png">
    
  

  <link href="https://clibequilibrium.github.io//feed.xml" type="application/rss+xml" rel="alternate" title="Alex's Blog Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-dark-11327753546b2135c989eee5cd83497a2734b702928d016839d795f6c706e3d5.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-dark-d161409442b7e523089f24d08d0a55951549ece7504207c376d53b020713494d.png">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-f946b2d365f28364071963a9bb824c4d904fadef0da345f228b25f3d50863a75.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-bcaa7adbe8b0e4167122052436988b49413a261e719ef36c9c48685705aa400e.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Alex's Blog">Alex's Blog</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about" xlink:href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
      <li>
        <a href="https://github.com/clibequilibrium" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github" xlink:href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-610197c56844c5ba34608b2018c4cc3b79f8833e2efc7a99bcb5589f1d3cfd7b.svg#icon-theme" xlink:href="/assets/theme-610197c56844c5ba34608b2018c4cc3b79f8833e2efc7a99bcb5589f1d3cfd7b.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>Equilibrium Engine</h1>
            <p>Welcome to my Game Engine series. Here I will share my journey of creating a multi-threaded engine using ECS from scratch using C/C++ and applying Data Oriented Design.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    November 14, 2021
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      5 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/c" title="See all posts with tag 'C'">C</a>
    
      
      <a href="/tag/cxx" title="See all posts with tag 'CXX'">CXX</a>
    
      
      <a href="/tag/ecs" title="See all posts with tag 'ECS'">ECS</a>
    
      
      <a href="/tag/sdl" title="See all posts with tag 'SDL'">SDL</a>
    
      
      <a href="/tag/bgfx" title="See all posts with tag 'BGFX'">BGFX</a>
    
      
      <a href="/tag/imgui" title="See all posts with tag 'IMGUI'">IMGUI</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <h2 id="introduction">Introduction</h2>
<h3 id="another-game-engine">Another game engine?</h3>
<p>In my career I went over many game engines, <strong>Unity</strong>, <strong>Unreal</strong>, <strong>Unigine</strong>, <strong>Xenko</strong>, I remember my first game engine I tried was actually <strong>NeoAxis</strong> engine. They were all fun to use, there is so much you can do with a game engine. If you an artist, you may quickly prototype something beautiful, if you are a programmer you can prototype something that works. But sooner or later you realize that you want to create more, and there shall be no boundaries of what you can do. Unfortunately, for me the engines listed above impose some sort of limitations.</p>

<ol>
  <li>Unity, offers friendly mobile support in exchange of modern CLR. Unity is user-friendly, fun but lacks scalability as it single-threaded. There is Unity ECS and Job System which is promising but it hasn’t been updated for more than a year.</li>
  <li>Unreal Engine, the industry standard for AAA games, unfortunately constrains you to use Blueprints and some % of C++. In my experience, Unreal is super quick to compile when using BP but nightmare to compile when using C++.</li>
  <li>Unigine, has double precision out of the box which allows you to create drastically large open spaces (however requires pricey license), it uses floats (for community version), features friendly Discord community, and lots of documentation. it offers both C# and C++ scripting languages which makes it awesome to develop with. Unfortunately lack of source code makes it difficult to add new features.</li>
</ol>

<p>These are just brief reasons of why I would want to create something myself. On top of which, I do not want to be dependent on somebody or wait for someone to fix something I have no control over. Even if I fail to, I will gain so much more experience developing a game engine rather than using someone’s else.</p>

<h3 id="equilibrium-engine">Equilibrium Engine</h3>
<p>Equilibrium - the balance between forces. The name I came up with when I was developing my <a href="https://youtu.be/DIDXbnmiub8">Networking library</a>. I decided to name my engine that way since I want to develop a scalable architecture in which all the systems are balanced and work in harmony (in parallel). To achieve that, each system will be given a finite amount of work without false sharing and no global state. ECS pattern perfectly fits to that due to its decomposition and Entity -&gt; Component -&gt; System nature. A system only iterates a specific set of components which makes it trivial to multi-thread. If you really want to know more about ECS in action feel free to watch first 5-10 minutes of <a href="https://youtu.be/W3aieHjyNvw">Overwatch Gameplay Architecture and Netcode</a></p>

<h3 id="what-is-the-plan">What is the plan?</h3>
<p>My current plan is to develop a game engine in fully Data Oriented Design applying <strong>ECS (Entity Component System)</strong> pattern. The engine is required to be highly customizable, scalable as it is modular, meaning all the futures could be added or removed on the fly with a simple line of code or a system checkbox toggle. The engine will feature lock-free work-stealing job system which would allow parallel computing. Below you may see I sample API for an app using my engine platform at the current stage.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include</span> <span class="cpf">&lt;equilibrium.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// Create Engine instance;</span>
  <span class="n">eq</span><span class="o">::</span><span class="n">Engine</span> <span class="n">engine</span><span class="p">;</span>
  <span class="n">eq</span><span class="o">::</span><span class="n">World</span> <span class="o">&amp;</span><span class="n">world</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">GetWorld</span><span class="p">();</span>

  <span class="c1">// Add systems</span>
  <span class="n">world</span><span class="p">.</span><span class="n">AddSystem</span><span class="o">&lt;</span><span class="n">eq</span><span class="o">::</span><span class="n">systems</span><span class="o">::</span><span class="n">SdlSystem</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">world</span><span class="p">.</span><span class="n">AddSystem</span><span class="o">&lt;</span><span class="n">eq</span><span class="o">::</span><span class="n">systems</span><span class="o">::</span><span class="n">BgfxSystem</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">world</span><span class="p">.</span><span class="n">AddSystem</span><span class="o">&lt;</span><span class="n">eq</span><span class="o">::</span><span class="n">systems</span><span class="o">::</span><span class="n">ImGuiBgfxSdlSystem</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">world</span><span class="p">.</span><span class="n">AddSystem</span><span class="o">&lt;</span><span class="n">eq</span><span class="o">::</span><span class="n">systems</span><span class="o">::</span><span class="n">ImGuiEntityInspector</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="c1">// Create your app</span>
  <span class="n">eq</span><span class="o">::</span><span class="n">Entity</span> <span class="n">app</span> <span class="o">=</span> <span class="n">world</span><span class="p">.</span><span class="n">CreateEntity</span><span class="p">(</span><span class="s">"MyAwesomeApp"</span><span class="p">);</span>
  <span class="n">app</span><span class="p">.</span><span class="n">AddComponent</span><span class="o">&lt;</span><span class="n">eq</span><span class="o">::</span><span class="n">components</span><span class="o">::</span><span class="n">AppWindow</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1366</span><span class="p">,</span> <span class="mi">768</span><span class="p">);</span>
  <span class="n">app</span><span class="p">.</span><span class="n">AddComponent</span><span class="o">&lt;</span><span class="n">eq</span><span class="o">::</span><span class="n">components</span><span class="o">::</span><span class="n">Scene</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="n">engine</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p><em>Example of a system header:</em></p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#pragma once
</span>
<span class="cp">#define SDL_MAIN_HANDLED
#include</span> <span class="cpf">&lt;SDL2/SDL.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">"components/gui.h"</span><span class="cp">
#include</span> <span class="cpf">"components/input.h"</span><span class="cp">
#include</span> <span class="cpf">"components/sdl_window.h"</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">"base_system.h"</span><span class="cp">
</span>
<span class="k">namespace</span> <span class="n">eq</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="n">systems</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">SdlSystem</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseSystem</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">SdlSystem</span><span class="p">(</span><span class="n">World</span> <span class="o">*</span><span class="n">world</span><span class="p">);</span>
  <span class="kt">void</span> <span class="n">Update</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="o">~</span><span class="n">SdlSystem</span><span class="p">();</span>
<span class="p">};</span>

<span class="p">}</span> <span class="c1">// namespace systems</span>
<span class="p">}</span> <span class="c1">// namespace eq</span></code></pre></figure>

<p><a href="/assets/posts/sample_app-d1f04aff219092a1b1f590ec7af868d6d6f858f80d47827d92d38931275a53f9.png">
  <img src="/assets/posts/sample_app-d1f04aff219092a1b1f590ec7af868d6d6f858f80d47827d92d38931275a53f9.png" alt="Sample application" class="zooming" data-rjs="/assets/posts/sample_app-d1f04aff219092a1b1f590ec7af868d6d6f858f80d47827d92d38931275a53f9.png" data-zooming-width="1919" data-zooming-height="1041" />
</a></p>
<figcaption style="text-align:center;"><em>Sample application</em></figcaption>

<h3 id="what-i-use">What I use</h3>
<p>Currently I am maintaining <strong>C++17</strong> branch of the engine using <a href="https://github.com/skypjack/entt">entt</a> library. <a href="https://www.libsdl.org/">SDL</a> for windowing,
<a href="https://github.com/bkaradzic/bgfx">BGFX</a> for rendering and <a href="https://github.com/ocornut/imgui">ImGui</a> - you guessed it right, for UI :) I also maintain a <strong>C99</strong> branch where I use all of the above except instead of entt I utilize <a href="https://github.com/SanderMertens/flecs">flecs</a>. It is exciting to finish both branches and to compare performance, see how friendly is the API and how hard is to develop with either or both of the libraries. I use CMake for building system and GCC compiler with mingw installed on Windows via MSYS2. I occasionally test my engine on Ubuntu to make sure it compiles and runs without a problem. I am not a C++ nor C professional so any feedback will be appreciated. My main expertise is C# but I am willing to learn as many languages as I can.</p>

<p>BGFX and ImGui are both awesome libraries, bgfx provides you with a cross platform rendering. You write a shared once and compile to any of the rendering backends, DX, Metal, OpenGL, Vulkan, WebGL, even GNM if you are a licensed PS4 developer. It also supports a lot of platforms. ImGui is simply awesome for developing not only games but applications. Below you may see my successful implementation of sdl + bgfx + imgui (docking branch)</p>

<div class="embed-responsive embed-responsive-16by9">
<video muted="" autoplay="" controls="">
  <source src="/assets/docking-c9a6e060ce2e05e72f6357088e6ee756d551b805047395e613926b38ef7d816d.mp4" type="video/mp4" />
</video>
</div>

<h3 id="current-week-accomplishment">Current week accomplishment</h3>
<p>For the past week I was working on assembling an entity editor. Luckily I was able to find an <a href="https://github.com/Green-Sky/imgui_entt_entity_editor">open source</a> editor which I then slightly modified and extended. In the future I plan to add system list, system performance and collect queries from systems to see which components does a system modify.</p>

<div class="embed-responsive embed-responsive-16by9">
<video muted="" autoplay="" controls="">
  <source src="/assets/entity_inspector-d2242aeff061de7628d839b2172d2e6082fab6d1aee6b89d52517fa8665bfcd4.mp4" type="video/mp4" />
</video>
</div>

<h3 id="conclusion">Conclusion</h3>
<p>Developing anything challenging is always fun, it keeps me focused, anxious from time to time (but in a healthy way). You start to feel it, you want to create and you tame the feeling, and if you don’t create - you accumulate enough anxiety to get you started again.</p>

<p>Stay tuned and I will be sharing more technical aspect of the development and will eventually go open source when the engine matures. Let me know in the comment section if you would like to get access to the earliest version of the engine and hack around, I will be more than happy to provide you with one and to know that somebody is interested!</p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Equilibrium+Engine%20-%20https://clibequilibrium.github.io//posts/game-engine-series" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://clibequilibrium.github.io//posts/game-engine-series" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
        </article>
        <footer class="footer scrollappear">
  <p>
    Template by Nielsen Ramon. Get it <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Download Chalk">here</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-212140237-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-212140237-1');
  </script>


<script src="/assets/vendor-1a8f6e33220f845e569c20b3c09a5d43f87908ea7168ea139ce2135770f7b1b5.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


  <script src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js" type="text/javascript"></script>

</body>
</html>
